

{% extends 'user_header_footer.html' %}

 <!--<meta charset="UTF-8">-->
 <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
 <!-- <title>Hotel Booking</title>-->
   {% block header_footer_head %}
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.13/flatpickr.min.css" rel="stylesheet">

  {% endblock header_footer_head %}
  {% block user_header_footer_style %}
    .booking-form-card {
      border-radius: 10px;
      overflow: hidden;
      border: none;
    }
    .form-section {
      background-color: #f8f9fa;
      border-radius: 8px;
    }
    .hotel-img {
      height: 250px;
      object-fit: cover;
    }
    .price-display {
      font-size: 24px;
      color: #0d6efd;
    }
  {% endblock user_header_footer_style %}

{% block mainContent %}

  <div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <div class="card shadow booking-form-card">
          <h3 class="card-header bg-primary text-white py-3">
            <i class="bi bi-calendar-check me-2"></i>Book Your Stay
          </h3>

          <div class="card-body p-4">
            <div class="row mb-4">
              <div class="col-md-4 mb-3 mb-md-0">
                <img src="{{ hotel_image }}" class="img-fluid rounded hotel-img w-100" alt="{{ room.name }}">
              </div>
              <div class="col-md-8">
                <h3>{{ hotel_name }}</h3>
                <div class="d-flex flex-wrap gap-2 mb-2">
                  <!--<span class="badge bg-light text-dark"><i class="bi bi-building me-1"></i>{{ hotel_type }}</span>-->
                  <span class="badge bg-light text-dark"><i class="bi bi-geo-alt me-1"></i>{{ hotel_place }}</span>
                </div>
                <p class="mb-2">{{ hotel_desc |truncatechars:150 }}</p>
                <div class="price-display">
                  <span>₹<span id="basePrice">{{ hotel_rent }}</span></span>
                  <small class="text-muted" >per night</small>
                </div>
              </div>
            </div>

            <form id="bookingForm" method="post" action="/paymentForm/">
              {% csrf_token %}
              <input type="hidden" name="hotel_id" value="{{ hotel_id }}">
              <input type="hidden" name="totalHotelRent" id="totalHotelRent" value="">
              <input type="hidden" name="taxesInput" id = "taxesInput" value="">
              <input type="hidden" name="totalAmountInput" id = "totalPay" value="">

              <div class="form-section p-3 mb-4">
                <h4 class="mb-3"><i class="bi bi-house-door me-2"></i>Select Room Type</h4>
                <div class="row">
                  <div class="col-md-6">
                    <label for="roomTypeSelect" class="form-label">Room Type <span class="text-danger">*</span></label>
                    <select class="form-select" id="roomTypeSelect" name="hotelType" required>
                      <option value="standard" data-price-multiplier="1">Standard (₹{{ hotel_rent }})</option>
                      <option value="deluxe" data-price-multiplier="3">Deluxe (₹{{ deluxe_price }})</option>
                      <option value="premium" data-price-multiplier="7">Premium (₹{{ premium_price }})</option>
                    </select>
                    <small class="text-muted">Room prices are per night</small>
                  </div>
                </div>
              </div>

              <div class="form-section p-3 mb-4">
                <h4 class="mb-3"><i class="bi bi-calendar-range me-2"></i>Choose Your Dates</h4>

                <div class="row g-3">
                  <div class="col-md-6">
                    <label for="checkInDate" class="form-label">Check-in Date <span class="text-danger">*</span></label>
                    <div class="date-input-container">
                      <input type="date" class="form-control" id="checkInDate" name="checkInDate" required min="{{ today_date }}">
                      <!--<i class="bi bi-calendar3"></i>-->
                    </div>
                    <small class="text-muted">Check-in time: After 2:00 PM</small>
                  </div>

                  <div class="col-md-6">
                    <label for="checkOutDate" class="form-label">Check-out Date <span class="text-danger">*</span></label>
                    <div class="date-input-container">
                      <input type="date" class="form-control" name="checkOutDate" id="checkOutDate" required min="{{ tomorrow_date }}">
                      <!--<i class="bi bi-calendar3"></i>-->
                    </div>
                    <small class="text-muted">Check-out time: Before 12:00 PM</small>
                  </div>
                </div>
              </div>

              <div class="form-section p-3 mb-4">
                <h4 class="mb-3"><i class="bi bi-credit-card me-2"></i>Payment Details</h4>

                <div id="priceCalculation" class="p-3 border rounded">
                  <div class="d-flex justify-content-between mb-2">
                    <span><span id="roomTypeDisplay">Standard</span> Room (<span id="nights">0</span> nights × ₹<span id="perNightPrice">{{ hotel_rent }}</span>)</span>
                    <span>₹ <span id="roomTotal">0</span></span>
                  </div>
                  <div class="d-flex justify-content-between mb-2">
                    <span>Taxes & Fees (18%)</span>
                    <span>₹ <span id="taxes">0</span></span>
                  </div>
                  <div class="d-flex justify-content-between mt-2 pt-2 border-top">
                    <strong>Total Amount</strong>
                    <strong>₹ <strong class="text-primary" id="totalAmount">0</strong></strong>
                  </div>
                </div>
              </div>

              <div class="form-check mb-4">
                <input class="form-check-input" type="checkbox" id="termsCheck" required>
                <label class="form-check-label" for="termsCheck">
                  I agree to the <a href="#" data-bs-toggle="modal" data-bs-target="#termsModal">Terms and Conditions</a>
                </label>
              </div>

              <div class="d-grid">
                <button type="submit" class="btn btn-primary btn-lg">Confirm Booking</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Terms and Conditions Modal -->
  <div class="modal fade" id="termsModal" tabindex="-1" aria-labelledby="termsModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="termsModalLabel">Terms and Conditions</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <h6>Cancellation Policy</h6>
          <p>No cancellation XD</p>

          <h6>Check-in/Check-out Policy</h6>
          <p>Just bring money. No time limits</p>

          <h6>Payment Policy</h6>
          <p>Just pay bro</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>-->
      <!--<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>


  <script>

  document.addEventListener('DOMContentLoaded', function() {
  // Get references to the date input elements
  const checkInInput = document.getElementById('checkInDate');
  const checkOutInput = document.getElementById('checkOutDate');
  const roomTotalOutput = document.getElementById('roomTotal');
  const totalAmountOutput = document.getElementById('totalAmount');
  const taxesOutput = document.getElementById('taxes');
  const nights = document.getElementById('nights');
  const roomTypeSelect = document.getElementById('roomTypeSelect');
  const perNightPriceDisplay = document.getElementById('perNightPrice');
  const roomTypeDisplay = document.getElementById('roomTypeDisplay');
  const basePrice = {{ hotel_rent }};
  const hotelPrice = document.getElementById("basePrice");

  let currentMultiplier = 1;
  let hotelRent = 0;

  // Set minimum dates for check-in and check-out
  const today = new Date();
  today.setHours(0, 0, 0, 0); // Reset hours to midnight for proper comparison
  const tomorrow = new Date(today);
  tomorrow.setDate(tomorrow.getDate() + 1);

  // Format dates as YYYY-MM-DD for the input's min attribute
  const formatDateForInput = (date) => {
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    return `${year}-${month}-${day}`;
  };

  // Set minimum date constraints
  const todayFormatted = formatDateForInput(today);
  checkInInput.min = todayFormatted;
  checkOutInput.min = formatDateForInput(tomorrow);

  // If no date is selected yet, set today as default for check-in
  if (!checkInInput.value) {
    checkInInput.value = todayFormatted;
  }

  // Extra validation for check-in date to prevent past dates
  checkInInput.addEventListener('input', function() {
    const selectedDate = new Date(this.value);
    if (selectedDate < today) {
      this.value = todayFormatted;
    }
  });

  // When check-in date changes, update the minimum check-out date to be one day after
  checkInInput.addEventListener('change', function() {
    const selectedDate = new Date(this.value);
    if (selectedDate) {
      // Ensure the selected date is not before today
      if (selectedDate < today) {
        this.value = todayFormatted;
        selectedDate.setTime(today.getTime());
      }

      const nextDay = new Date(selectedDate);
      nextDay.setDate(nextDay.getDate() + 1);
      const nextDayFormatted = formatDateForInput(nextDay);
      checkOutInput.min = nextDayFormatted;

      // If current check-out date is now invalid, update it
      const checkOutDate = new Date(checkOutInput.value);
      if (!checkOutInput.value || checkOutDate <= selectedDate) {
        checkOutInput.value = nextDayFormatted;
      }
    }
    calculateDays();
  });

  // Add event listener to room type select
  roomTypeSelect.addEventListener('change', function() {
    // Get selected option
    const selectedOption = this.options[this.selectedIndex];

    // Update multiplier
    currentMultiplier = parseFloat(selectedOption.dataset.priceMultiplier);

    // Update display
    roomTypeDisplay.textContent = selectedOption.text.split(' ')[0];
    perNightPriceDisplay.textContent = Math.round(basePrice * currentMultiplier);
    hotelPrice.textContent = perNightPriceDisplay.textContent;

    // Recalculate total
    calculateDays();
  });

  // Function to calculate days between dates
  function calculateDays() {
    // Get dates from inputs
    const checkInDate = new Date(checkInInput.value);
    const checkOutDate = new Date(checkOutInput.value);

    // Check if both dates are valid
    if (isNaN(checkInDate.getTime()) || isNaN(checkOutDate.getTime())) {
      roomTotalOutput.textContent = "0";
      taxesOutput.textContent = "0";
      totalAmountOutput.textContent = "0";
      nights.textContent = "0";
      return;
    }

    // Calculate difference in days
    const timeDiff = checkOutDate - checkInDate;
    const daysDiff = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));

    // Apply room type multiplier to the base price
    const pricePerNight = basePrice * currentMultiplier;
    hotelRent = daysDiff * pricePerNight;

    // Handle invalid date ranges
    if (daysDiff <= 0) {
      alert("Check-out date must be after check-in date");
      checkOutInput.value = formatDateForInput(new Date(checkInDate.getTime() + (24 * 60 * 60 * 1000)));
      calculateDays(); // Recalculate with the corrected date
    } else {
      nights.textContent = daysDiff;
      roomTotalOutput.textContent = Math.round(hotelRent);
      const taxes = hotelRent * 0.18;
      taxesOutput.textContent = Math.round(taxes);
      totalAmountOutput.textContent = Math.round(hotelRent + taxes);

      document.getElementById('taxesInput').value = Math.round(taxes);
      document.getElementById('totalPay').value = Math.round(hotelRent + taxes);
      document.getElementById('totalHotelRent').value = Math.round(hotelRent);
    }
  }

  // Add event listener to check-out date input
  checkOutInput.addEventListener('change', calculateDays);
});










































  </script>

{% endblock mainContent %}

{% block user_header_footer_script %}

{% endblock user_header_footer_script %}